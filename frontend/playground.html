<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Nexus - Multi-Agent Playground</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        :root {
            --primary: #2a2b38;
            --secondary: #1f2029;
            --accent: #5d5dff;
            --text: #9498a4;
            --white: #ffffff;
            --user-msg: #2b2c3d;
            --ai-msg: #32334a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: var(--secondary);
            color: var(--text);
            min-height: 100vh;
            padding-top: 80px;
        }
        
        .navbar {
            background: var(--primary);
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            color: var(--white);
            text-decoration: none;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .logo span {
            color: var(--accent);
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
        }
        
        .nav-link {
            color: var(--text);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .nav-link:hover {
            color: var(--white);
        }
        
        .playground-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            height: calc(100vh - 80px);
        }
        
        .sidebar {
            background: var(--primary);
            border-radius: 15px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }
        
        .agent-selection-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .agent-dropdown {
            flex: 1;
            background: var(--secondary);
            color: var(--white);
            border: none;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .add-agent-btn {
            background: var(--accent);
            color: var(--white);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .add-agent-btn:hover {
            transform: translateY(-2px);
        }
        
        .agent-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--secondary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .agent-toggle:hover {
            transform: translateX(5px);
        }
        
        .agent-toggle.active {
            background: var(--accent);
            color: var(--white);
        }
        
        .agent-toggle img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }
        
        .chat-container {
            background: var(--primary);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }
        
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 80px;
            width: 100%;
            max-width: 100%;
        }
        
        .message {
            padding: 1rem;
            border-radius: 10px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
            position: relative;
            display: inline-block;
            margin: 0.5rem 0;
            width: auto;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .user-message {
            background: var(--user-msg);
            color: var(--white);
            align-self: flex-end;
        }
        
        .ai-message {
            background: var(--ai-msg);
            color: var(--white);
            align-self: flex-start;
            min-width: 200px;
        }
        
        .message-content {
            white-space: pre-wrap;
            line-height: 0.9;
            word-wrap: break-word;
            overflow-wrap: break-word;
            width: 100%;
        }
        
        .message-content p {
            margin: 0 0 0.5rem 0;
        }
        
        .message-content p:last-child {
            margin-bottom: 0;
        }
        
        .message-content ul,
        .message-content ol {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }
        
        .message-content li {
            margin: 0.25rem 0;
        }
        
        .agent-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            padding-right: 60px;
        }
        
        .rating-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--accent);
            color: var(--white);
            border: none;
            border-radius: 5px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 0.75rem;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }
        
        .rating-button:hover {
            opacity: 1;
        }
        
        .message-input-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem;
            background: var(--primary);
            border-top: 1px solid rgba(255,255,255,0.1);
            border-radius: 0 0 15px 15px;
        }
        
        .message-input-wrapper {
            display: flex;
            gap: 1rem;
            background: var(--secondary);
            padding: 0.5rem;
            border-radius: 10px;
        }
        
        .message-input {
            flex-grow: 1;
            background: none;
            border: none;
            color: var(--white);
            padding: 0.5rem;
            outline: none;
            resize: none;
            min-height: 40px;
            max-height: 150px;
        }
        
        .send-button {
            background: var(--accent);
            color: var(--white);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .send-button:hover {
            transform: translateY(-2px);
        }
        
        .send-button:disabled {
            background: var(--text);
            cursor: not-allowed;
            transform: none;
        }
        
        /* Rating Modal Styles */
        .rating-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .rating-modal.active {
            display: flex;
        }
        
        .rating-content {
            background: var(--primary);
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            color: var(--white);
            animation: fadeIn 0.3s ease;
        }
        
        .close-rating {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--text);
            cursor: pointer;
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }
        
        .close-rating:hover {
            color: var(--white);
        }
        
        .rating-category {
            margin: 1rem 0;
        }
        
        .rating-stars {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .star {
            cursor: pointer;
            color: var(--text);
            transition: color 0.3s ease;
            font-size: 1.2rem;
        }
        
        .star.active {
            color: #ffd700;
        }
        
        .rating-feedback {
            margin-top: 1.5rem;
        }
        
        .rating-feedback textarea {
            width: 100%;
            background: var(--secondary);
            border: none;
            border-radius: 8px;
            padding: 0.8rem;
            color: var(--white);
            margin-top: 0.5rem;
            min-height: 100px;
            resize: vertical;
        }
        
        .submit-rating {
            background: var(--accent);
            color: var(--white);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 1rem;
            transition: transform 0.3s ease;
            width: 100%;
        }
        
        .submit-rating:hover {
            transform: translateY(-2px);
        }
        
        .rating-header {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--white);
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        /* Code and List Formatting */
        .bullet-point {
            margin: 0.25rem 0 0.25rem 1.25rem;
            position: relative;
        }
        
        .bullet-point:before {
            content: "â€¢";
            position: absolute;
            left: -1rem;
            color: var(--accent);
        }
        
        .numbered-point {
            margin: 0.25rem 0 0.25rem 1.25rem;
            position: relative;
            counter-increment: item;
        }
        
        .numbered-point:before {
            content: counter(item) ".";
            position: absolute;
            left: -1.25rem;
            color: var(--accent);
        }
        
        .code-block {
            background: var(--secondary);
            padding: 0.75rem;
            border-radius: 6px;
            margin: 0.5rem 0;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow-x: auto;
            max-width: 100%;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .code-block::-webkit-scrollbar {
            height: 8px;
        }
        
        .code-block::-webkit-scrollbar-track {
            background: var(--secondary);
            border-radius: 4px;
        }
        
        .code-block::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }
        
        .code-block::-webkit-scrollbar-thumb:hover {
            background: #4a4aff;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--secondary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #4a4aff;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <a href="#" class="logo">AI<span>Nexus</span></a>
            <div class="nav-links">
                <a href="../frontend/index.html" class="nav-link">Home</a>
                <a href="../frontend/profiles.html" class="nav-link">Profiles</a>
                <a href="#" class="nav-link">Playground</a>
                <a href="../frontend/dev.html" class="nav-link">Development</a>
            </div>
        </div>
    </nav>

    <div class="playground-container">
        <div class="sidebar">
            <div class="agent-selection-container">
                <select class="agent-dropdown" id="agentSelect">
                    <option value="">Select Agent</option>
                </select>
                <button class="add-agent-btn" id="addAgent">
                    Add
                </button>
            </div>
            <div id="agentToggles"></div>
        </div>
        <div class="rating-modal" id="ratingModal">
            <div class="rating-content">
                <button class="close-rating" onclick="closeRatingModal()">Ã—</button>
                <div class="rating-header">Rate Response</div>
                <div id="ratingCategories">
                    <!-- Rating categories will be populated here -->
                </div>
                <div class="rating-feedback">
                    <label for="feedback">Additional Feedback (Optional)</label>
                    <textarea id="feedback" placeholder="Share your thoughts..."></textarea>
                </div>
                <button class="submit-rating" onclick="submitRating()">Submit Rating</button>
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="message ai-message">
                    ðŸ‘‹ Welcome to AI Nexus! Select an agent to begin chatting.
                </div>
            </div>

            <div class="message-input-container">
                <div class="message-input-wrapper">
                    <textarea 
                        class="message-input" 
                        id="messageInput"
                        placeholder="Type your message..."
                        rows="1"
                    ></textarea>
                    <button class="send-button" id="sendButton" disabled>
                        Send
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Agent data
        const agents = [
            {
                name: "Atlas",
                specialty: "General Intelligence",
                description: "A versatile AI agent for complex reasoning and problem-solving.",
                image: "./assets/agents/atlas.avif"
            },
            {
                name: "Nova",
                specialty: "Scientific Research",
                description: "Specialized in scientific analysis and research synthesis.",
                image: "./assets/agents/nova.avif"
            },
            {
                name: "Sage",
                specialty: "Education",
                description: "Expert in educational content and tutoring.",
                image: "./assets/agents/sage.avif"
            }
        ];

        // DOM elements
        const agentSelect = document.getElementById('agentSelect');
        const addAgentBtn = document.getElementById('addAgent');
        const agentToggles = document.getElementById('agentToggles');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');

        // State
        let activeAgents = new Set();
        let isTyping = false;
        let currentRatingAgent = null;
        let currentRatingMessageId = null;
        const ratingCategories = ['Accuracy', 'Creation', 'Problem Solving', 'Relevancy', 'Processing', 'Analysis'];
        const ratings = {};

        // Initialize agents dropdown
        agents.forEach(agent => {
            const option = document.createElement('option');
            option.value = agent.name;
            option.textContent = agent.name;
            agentSelect.appendChild(option);
        });

        // Handle adding agents
        addAgentBtn.addEventListener('click', () => {
            const selectedAgent = agents.find(a => a.name === agentSelect.value);
            if (!selectedAgent) return;
            
            if (!Array.from(activeAgents).some(a => a.name === selectedAgent.name)) {
                activeAgents.add(selectedAgent);
                createAgentToggle(selectedAgent);
                updateSendButtonState();
                
                // Add welcome message
                addMessage(`Hello! I'm ${selectedAgent.name}, specialized in ${selectedAgent.specialty}.`, 'ai', selectedAgent);
            }
        });

        // Create agent toggle element
        function createAgentToggle(agent) {
            const toggle = document.createElement('div');
            toggle.className = 'agent-toggle active';
            toggle.innerHTML = `
                <img src="${agent.image}" alt="${agent.name}">
                <span>${agent.name}</span>
            `;

            toggle.addEventListener('click', () => {
                toggle.classList.toggle('active');
                if (toggle.classList.contains('active')) {
                    activeAgents.add(agent);
                } else {
                    activeAgents.delete(agent);
                }
                updateSendButtonState();
            });

            agentToggles.appendChild(toggle);
        }

        // Handle message input
        messageInput.addEventListener('input', () => {
            messageInput.style.height = 'auto';
            messageInput.style.height = messageInput.scrollHeight + 'px';
            updateSendButtonState();
        });

        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Handle sending messages
        sendButton.addEventListener('click', sendMessage);

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || isTyping || activeAgents.size === 0) return;
        
            // Add user message
            addMessage(message, 'user');
            messageInput.value = '';
            messageInput.style.height = 'auto';
            updateSendButtonState();
        
            // Show typing indicator
            isTyping = true;
            updateSendButtonState();
            
            try {
                // Prepare the request to the backend
                const activeAgentArray = Array.from(activeAgents);
                const response = await fetch('http://localhost:5000/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        agents: activeAgentArray
                    })
                });
        
                const responses = await response.json();
        
                // Display responses for each agent
                activeAgentArray.forEach((agent, index) => {
                    setTimeout(() => {
                        const agentResponse = responses[agent.name];
                        addMessage(agentResponse, 'ai', agent);
                        
                        if (index === activeAgentArray.length - 1) {
                            isTyping = false;
                            updateSendButtonState();
                        }
                    }, index * 1000); // Stagger responses
                });
            } catch (error) {
                console.error('Error:', error);
                addMessage('An error occurred while generating responses.', 'ai');
                isTyping = false;
                updateSendButtonState();
            }
        }

        // Generate AI response
        function generateResponse(agent, userMessage) {
            const responses = [
                `Based on my ${agent.specialty} expertise, I think...`,
                `From a ${agent.specialty} perspective, I'd say...`,
                `Interesting point! In ${agent.specialty}, we often...`,
                `Let me approach this from my ${agent.specialty} background...`
            ];
            return responses[Math.floor(Math.random() * responses.length)] + 
                   " " + userMessage.substring(0, 20) + "...";
        }

        function initializeRatingCategories() {
            const container = document.getElementById('ratingCategories');
            container.innerHTML = '';

            ratingCategories.forEach(category => {
                const div = document.createElement('div');
                div.className = 'rating-category';
                div.innerHTML = `
                    <div>${category}</div>
                    <div class="rating-stars" data-category="${category.toLowerCase().replace(' ', '-')}">
                        ${Array.from({length: 5}, (_, i) => `
                            <span class="star" onclick="setRating('${category.toLowerCase().replace(' ', '-')}', ${i + 1})">â˜…</span>
                        `).join('')}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function formatMessageText(text) {
            // Split text into lines
            const lines = text.split('\n');
            let formattedContent = '';
            let inList = false;
            let listType = null;
            let listContent = '';

            for (let line of lines) {
                line = line.trim();
                
                // Skip empty lines
                if (!line) {
                    if (inList) {
                        formattedContent += listContent;
                        listContent = '';
                        inList = false;
                    }
                    formattedContent += '<br>';
                    continue;
                }

                // Handle bullet points
                if (line.startsWith('- ') || line.startsWith('â€¢ ') || line.startsWith('* ')) {
                    if (!inList || listType !== 'bullet') {
                        if (inList) {
                            formattedContent += listContent;
                        }
                        listContent = '<div class="bullet-list">';
                        inList = true;
                        listType = 'bullet';
                    }
                    listContent += `<div class="bullet-point">${line.substring(2)}</div>`;
                    continue;
                }

                // Handle numbered points
                if (/^\d+\.\s/.test(line)) {
                    if (!inList || listType !== 'numbered') {
                        if (inList) {
                            formattedContent += listContent;
                        }
                        listContent = '<div class="numbered-list" style="counter-reset: item 0;">';
                        inList = true;
                        listType = 'numbered';
                    }
                    listContent += `<div class="numbered-point">${line.substring(line.indexOf(' ') + 1)}</div>`;
                    continue;
                }

                // Handle code blocks
                if (line.startsWith('```')) {
                    if (inList) {
                        formattedContent += listContent;
                        listContent = '';
                        inList = false;
                    }
                    formattedContent += '<div class="code-block">';
                    continue;
                }
                if (line.endsWith('```')) {
                    formattedContent += '</div>';
                    continue;
                }

                // Handle headings
                if (line.startsWith('#')) {
                    if (inList) {
                        formattedContent += listContent;
                        listContent = '';
                        inList = false;
                    }
                    const level = line.match(/^#+/)[0].length;
                    const text = line.substring(level).trim();
                    formattedContent += `<h${level}>${text}</h${level}>`;
                    continue;
                }

                // Regular paragraph text
                if (!inList) {
                    formattedContent += `<p>${line}</p>`;
                } else {
                    // End current list if we're not in a list item anymore
                    formattedContent += listContent + '</div>';
                    formattedContent += `<p>${line}</p>`;
                    inList = false;
                    listContent = '';
                }
            }

            // Close any remaining lists
            if (inList) {
                formattedContent += listContent + '</div>';
            }

            return formattedContent;
        }

        // Add message to chat
        function addMessage(text, type, agent = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message animate__animated animate__fadeIn`;
            
            if (type === 'ai' && agent) {
                const messageId = `msg-${Date.now()}`;
                messageDiv.setAttribute('data-message-id', messageId);
                
                messageDiv.innerHTML = `
                    <div class="agent-header" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <img src="${agent.image}" alt="${agent.name}" style="width: 24px; height: 24px; border-radius: 50%;">
                        <span style="color: var(--accent)">${agent.name}</span>
                        <button class="rating-button" onclick="openRatingModal('${agent.name}', '${messageId}')">Rate Response</button>
                    </div>
                    <div class="message-content">
                        ${formatMessageText(text)}
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-content">
                        ${formatMessageText(text)}
                    </div>
                `;
            }
        
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        
        function openRatingModal(agentName, messageId) {
            currentRatingAgent = agentName;
            currentRatingMessageId = messageId;
            document.getElementById('ratingModal').classList.add('active');
            initializeRatingCategories();
            // Reset ratings
            ratingCategories.forEach(category => {
                ratings[category.toLowerCase().replace(' ', '-')] = 0;
            });
            document.getElementById('feedback').value = '';
        }

        function closeRatingModal() {
            document.getElementById('ratingModal').classList.remove('active');
            currentRatingAgent = null;
            currentRatingMessageId = null;
        }

        function setRating(category, value) {
            ratings[category] = value;
            const stars = document.querySelector(`[data-category="${category}"]`).children;
            Array.from(stars).forEach((star, index) => {
                star.classList.toggle('active', index < value);
            });
        }

        function submitRating() {
            const feedback = document.getElementById('feedback').value;
            const ratingData = {
                agentName: currentRatingAgent,
                messageId: currentRatingMessageId,
                ratings: { ...ratings },
                feedback: feedback,
                timestamp: new Date().toISOString()
            };
            
            console.log('Rating Data:', ratingData);
            // Here you can add your code to send this data to your Solidity smart contract
            
            closeRatingModal();
        }

        // Initialize the chat interface
        document.addEventListener('DOMContentLoaded', initChat);

        // Update send button state
        function updateSendButtonState() {
            const hasText = messageInput.value.trim().length > 0;
            const hasAgents = activeAgents.size > 0;
            sendButton.disabled = !hasText || !hasAgents || isTyping;
        }

        // Initial button state
        updateSendButtonState();
        // Add typing indicator
        function showTypingIndicator() {
            const indicatorDiv = document.createElement('div');
            indicatorDiv.className = 'typing-indicator';
            indicatorDiv.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            chatMessages.appendChild(indicatorDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = chatMessages.querySelector('.typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Handle agent switching animation
        function animateAgentTransition(agentToggle) {
            agentToggle.style.transform = 'translateX(10px)';
            setTimeout(() => {
                agentToggle.style.transform = 'translateX(0)';
            }, 200);
        }

        // Clear chat
        function clearChat() {
            while (chatMessages.firstChild) {
                chatMessages.removeChild(chatMessages.firstChild);
            }
            addMessage('Chat cleared. Select agents to start a new conversation.', 'ai');
        }

        // Initialize message counter
        let messageCount = 0;

        // Update message count
        function updateMessageCount() {
            messageCount++;
            const countDisplay = document.createElement('div');
            countDisplay.style.position = 'absolute';
            countDisplay.style.right = '10px';
            countDisplay.style.top = '10px';
            countDisplay.style.color = 'var(--text)';
            countDisplay.textContent = `Messages: ${messageCount}`;
            chatMessages.appendChild(countDisplay);
        }

        // Handle message overflow
        chatMessages.addEventListener('scroll', () => {
            if (chatMessages.scrollTop + chatMessages.clientHeight >= chatMessages.scrollHeight) {
                chatMessages.classList.add('at-bottom');
            } else {
                chatMessages.classList.remove('at-bottom');
            }
        });

        // Resize handler
        window.addEventListener('resize', () => {
            if (messageInput) {
                messageInput.style.height = 'auto';
                messageInput.style.height = messageInput.scrollHeight + 'px';
            }
        });

        // Error handler
        function handleError(error) {
            console.error('Error:', error);
            addMessage('An error occurred. Please try again.', 'ai');
            isTyping = false;
            updateSendButtonState();
        }

        // Initialize the chat interface
        function initChat() {
            // Clear any existing messages
            clearChat();
            
            // Add initial welcome message
            addMessage('ðŸ‘‹ Welcome to AI Nexus! Select an agent to begin chatting.', 'ai');
            
            // Reset state
            activeAgents.clear();
            messageCount = 0;
            isTyping = false;
            
            // Update UI
            updateSendButtonState();
            
            // Clear agent toggles
            while (agentToggles.firstChild) {
                agentToggles.removeChild(agentToggles.firstChild);
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initChat);

    </script>
</body>
</html>